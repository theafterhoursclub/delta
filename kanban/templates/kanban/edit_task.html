{% extends "internal_base.html" %}
{% load static %}
{% block internal %}
<h1>{{ task.title }}</h1>
<div class="d-flex justify-content-center align-items-center" style="min-height: 70vh;">
    <div class="col-md-6 col-lg-5">
        <div class="card p-4 shadow-sm bg-light">
            <form method="post" id="task-form">
                {% csrf_token %}
                {% for field in form %}
                    <div class="mb-3" id="field-{{ field.name }}">
                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                        {% if field.name == "description" %}
                            <textarea
                                id="id_description"
                                name="description"
                                class="form-control"
                            >{{ field.value|default_if_none:"" }}</textarea>
                        {% else %}
                            {{ field }}
                        {% endif %}
                        {% if field.help_text %}
                            <div class="form-text">{{ field.help_text }}</div>
                        {% endif %}
                        {% for error in field.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endfor %}
                <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    <a href="{% url 'backlog' %}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="{% static 'tinymce/tinymce.min.js' %}"></script>
<script>
    tinymce.init({
        selector: '#id_description',
        license_key: 'gpl',
        menubar: false,
        plugins: 'lists', // Removed 'link' to avoid 404 error
        toolbar: 'undo redo | bold italic underline | bullist numlist',
        branding: false,
        height: 250
    });

    function toggleDueFields() {
        const taskType = document.getElementById("id_task_type").value.toLowerCase();
        const dueDateDiv = document.getElementById("field-due_date");
        const bauWDDiv = document.getElementById("field-bau_working_day");
        if (taskType === "bau") {
            if (dueDateDiv) dueDateDiv.style.display = "none";
            if (bauWDDiv) bauWDDiv.style.display = "";
        } else {
            if (dueDateDiv) dueDateDiv.style.display = "";
            if (bauWDDiv) bauWDDiv.style.display = "none";
        }
    }
    document.addEventListener("DOMContentLoaded", function() {
        const taskTypeSelect = document.getElementById("id_task_type");
        if (taskTypeSelect) {
            taskTypeSelect.addEventListener("change", toggleDueFields);
            toggleDueFields();
        }
    });
</script>
{% endblock %}
